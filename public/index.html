<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Maine Farm Stand Finder</title>    
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="/js/config.js"></script>
    <script src="/js/AppState.js"></script>
    <script src="/js/mapLogic.js"></script>      <!-- Defines initAppMap, attemptMapInitialization, etc. -->


    <link rel="stylesheet" href="/css/style.css" />

    <!--
        Google Maps API script. 'async' means it loads without blocking HTML.
        'callback=initAppMap' means initAppMap (defined in mapLogic.js) will be called once the API is ready.
        mapLogic.js (and its dependencies like config, AppState) *must* be loaded and initAppMap must be global
        before this callback can successfully execute.
    -->
    <script async
          src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRGp81QHEPMm5l08QK3f2xrxtRBAWLpBY&libraries=places,geometry,marker,maps,geocoding&callback=initAppMap"></script>
    <!-- Twitter and Instagram Embeds (async is good for these) -->
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <script async src="https://www.instagram.com/embed.js"></script>

</head>
  <body class="bg-white antialiased"> <!-- Changed bg to white as per your css/style.css -->
    <div id="fb-root"></div>

    <div id="app-container" class="h-screen flex flex-col">
      <header class="bg-[#e8dcc3] shadow-md z-30 print:hidden">
        <!-- Container for centering and padding -->
        <div class="container mx-auto px-2 sm:px-4">
            <div class="flex flex-col sm:flex-row justify-between items-center py-2 gap-y-2 gap-x-4">
                <!-- Left Part: Logo/Title -->
                <div class="flex items-center gap-2 flex-shrink-0 self-start sm:self-center">
                    <img src="/images/flag.png" alt="Maine Flag" class="h-8 sm:h-10 w-auto object-contain"/>
                    <h1 class="text-lg sm:text-xl md:text-2xl font-bold whitespace-nowrap" style="color: #1b4a7b">
                        Farm Stand Finder
                    </h1>
                </div>
                <!-- Right Part: Controls (Search, Radius, Filters) -->
                <div class="flex flex-col sm:flex-row items-center gap-2 sm:gap-3 w-full sm:w-auto">
                    <!-- Search Input -->
                    <gmp-place-autocomplete
                        id="searchAutocompleteElement"
                        placeholder="Enter town, city, or address"
                        class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm"
                        place-fields="name,formatted_address,geometry,address_components,place_id,types"
                        country="us">
                    </gmp-place-autocomplete>
                    <!-- Radius Slider -->
                    <div class="flex items-center gap-1 sm:gap-2">
                        <label for="radiusSlider" class="text-xs sm:text-sm font-medium whitespace-nowrap" style="color: #3c4043">Radius:</label>
                        <input type="range" id="radiusSlider" name="radius" min="10" max="100" value="30" step="5"
                               class="w-20 sm:w-24 md:w-28 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-red-600"/>
                        <span id="radiusValue" class="text-xs sm:text-sm font-semibold w-10 text-right" style="color: #c53030">30 mi</span>
                    </div>
                    <!-- Product Filters Dropdown -->
                    <div class="relative">
                        <button id="productFilterToggle" class="px-3 py-2 border border-gray-300 rounded-lg text-xs sm:text-sm h-10 bg-white hover:bg-gray-50 flex items-center whitespace-nowrap">
                            Filter Products <span id="activeFilterCount" class="ml-1 hidden"></span>
                            <svg class="w-4 h-4 ml-1 sm:ml-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"> <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path> </svg>
                        </button>
                        <div id="productFilterDropdown" class="hidden absolute top-full right-0 sm:left-auto sm:right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-40 p-3 w-52 sm:w-60">
                            <div id="productFilterCheckboxes" class="space-y-1 max-h-60 overflow-y-auto custom-scrollbar text-xs">
                                <!-- Checkboxes will be populated by JavaScript -->
                            </div>
                            <button id="resetProductFilters" class="mt-3 w-full px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-gray-500 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                                Reset Filters
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
      </header>

      <main class="flex flex-grow relative">
        <!-- Social/Reviews Overlay (Left Panel) -->
        <div id="detailsOverlaySocial" class="detail-pop-overlay detail-pop-overlay-social custom-scrollbar hidden">
          <button id="closeDetailsOverlaySocialButton" class="overlay-close-button" aria-label="Close social details">
              <svg class="w-6 h-6 sm:w-7 sm:h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
          </button>
          <div class="pt-10 sm:pt-12 shrink-0"> <!-- Header area within overlay for close button padding -->
            <div class="mb-4 border-b border-gray-200 px-2 sm:px-4">
              <nav id="socialOverlayTabs" class="flex flex-wrap -mb-px" aria-label="Tabs">
                <button data-tab-target="social-photos-panel" class="social-tab-button group inline-flex items-center py-3 px-1 sm:px-2 border-b-2 font-medium text-xs sm:text-sm whitespace-nowrap"> <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> Photos </button>
                <button data-tab-target="social-reviews-panel" class="social-tab-button group inline-flex items-center py-3 px-1 sm:px-2 border-b-2 font-medium text-xs sm:text-sm whitespace-nowrap"> <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path></svg> Reviews </button>
                <button data-tab-target="social-facebook-panel" class="social-tab-button group inline-flex items-center py-3 px-1 sm:px-2 border-b-2 font-medium text-xs sm:text-sm whitespace-nowrap"> <svg class="w-4 h-4 mr-1 text-blue-600" viewBox="0 0 24 24" fill="currentColor"> <path d="M22.676 0H1.324C.593 0 0 .593 0 1.324v21.352C0 23.407.593 24 1.324 24h11.494v-9.294H9.689v-3.621h3.129V8.41c0-3.1 1.893-4.785 4.659-4.785 1.325 0 2.463.099 2.795.142v3.24h-1.92c-1.505 0-1.796.716-1.796 1.765v2.312h3.584l-.467 3.622h-3.116V24h6.116C23.407 24 24 23.407 24 22.676V1.324C24 .593 23.407 0 22.676 0z"></path></svg> Facebook </button>
                <button data-tab-target="social-instagram-panel" class="social-tab-button group inline-flex items-center py-3 px-1 sm:px-2 border-b-2 font-medium text-xs sm:text-sm whitespace-nowrap"> <svg class="w-4 h-4 mr-1 text-pink-600" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 1.272.058 2.166.293 2.913.595a4.877 4.877 0 011.76 1.177c.642.641.997 1.378 1.177 2.125.302.747.537 1.64.595 2.912.058 1.266.07 1.646.07 4.85s-.012 3.584-.07 4.85c-.058 1.272-.293 2.166-.595 2.913a4.877 4.877 0 01-1.177 1.76c-.641.642-1.378.997-2.125 1.177-.747.302-1.64.537-2.912.595-1.266.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-1.272-.058-2.166.293-2.913-.595a4.877 4.877 0 01-1.76-1.177c-.642-.641-.997-1.378-1.177 2.125-.302-.747-.537 1.64-.595-2.912-.058-1.266-.07-1.646-.07-4.85s.012-3.584.07-4.85c.058-1.272.293 2.166.595 2.913a4.877 4.877 0 011.177-1.76c.641-.642 1.378.997 2.125 1.177.747.302 1.64.537 2.912.595L7.15 2.233C8.416 2.175 8.796 2.163 12 2.163zm0 1.802c-3.075 0-3.444.012-4.642.068C8.176 4.019 7.51 4.246 6.98 4.446a3.23 3.23 0 00-1.464 1.015c-.448.447-.793.89-1.015 1.464c-.2.53-.427 1.197-.48 2.378C4.013 8.556 4 8.925 4 12s.012 3.444.068 4.642c.053 1.18.28 1.847.48 2.377c.222.575.567 1.018 1.015 1.465c.447.447.89.793 1.464 1.015c.53.2 1.197.427 2.378.48c1.198.056 1.567.068 4.642.068s3.444-.012 4.642-.068c1.18-.053 1.847-.28 2.377-.48c.575-.222 1.018-.567 1.465-1.015c.447-.447.793-.89 1.015-1.464c.2-.53.427-1.197.48-2.378c.056-1.198.068-1.567.068-4.642s-.012-3.444-.068-4.642c-.053-1.18-.28-1.847-.48-2.377c-.222-.575-.567-1.018-1.015-1.465c-.447-.447-.793-.89-1.015-1.464c-.53-.2-1.197-.427-2.378-.48C15.444 3.977 15.075 3.965 12 3.965zM12 7.198a4.802 4.802 0 100 9.604 4.802 4.802 0 000-9.604zm0 7.994a3.192 3.192 0 110-6.384 3.192 3.192 0 010 6.384zm6.385-7.852a1.145 1.145 0 100-2.29 1.145 1.145 0 000 2.29z"></path></svg> Instagram </button>
                <button data-tab-target="social-twitter-panel" class="social-tab-button group inline-flex items-center py-3 px-1 sm:px-2 border-b-2 font-medium text-xs sm:text-sm whitespace-nowrap"> <svg class="w-4 h-4 mr-1 text-blue-400" viewBox="0 0 24 24" fill="currentColor"> <path d="M23.643 4.937c-.835.37-1.732.62-2.675.733a4.67 4.67 0 002.048-2.578a9.3 9.3 0 01-2.958 1.13a4.66 4.66 0 00-7.938 4.25a13.229 13.229 0 01-9.602-4.868a4.662 4.662 0 001.444 6.216a4.613 4.613 0 01-2.11-.583v.06a4.656 4.656 0 003.737 4.567a4.615 4.615 0 01-2.105.08a4.662 4.662 0 004.351 3.234a9.368 9.368 0 01-5.786 1.995a9.5 9.5 0 01-1.112-.065a13.177 13.177 0 007.14 2.094c8.567 0 13.255-7.098 13.255-13.254c0-.203-.005-.405-.014-.606a9.46 9.46 0 002.323-2.41z"></path></svg> Twitter </button>
              </nav>
            </div>
          </div>
          <!-- Tab Content Scrollable Area -->
          <div class="flex-grow overflow-y-auto custom-scrollbar px-2 sm:px-4 pb-4">
            <div id="social-photos-panel" class="social-tab-content"><div id="socialOverlayGooglePhotosContainer" class="w-full"></div></div>
            <div id="social-reviews-panel" class="social-tab-content hidden"><div id="socialOverlayReviewsContainer" class="w-full"></div></div>
            <div id="social-facebook-panel" class="social-tab-content hidden"><div id="socialLinksContainer" class="w-full h-full"></div></div>
            <div id="social-instagram-panel" class="social-tab-content hidden"><div id="instagramFeedContainer" class="w-full"></div></div>
            <div id="social-twitter-panel" class="social-tab-content hidden"><div id="twitterTimelineContainer" class="w-full h-full"></div></div>
            <div id="social-directions-panel" class="social-tab-content hidden">
              <p class="text-sm text-gray-500 p-4">Directions for this shop are available in the other panel (shop details).</p>
            </div>
          </div>
        </div>

        <!-- Map Panel -->
        <section id="mapPanel" class="flex-grow"><div id="map" class="w-full h-full"></div></section>

        <!-- Listings Panel (Right) -->
        <section id="listingsPanel" class="w-full md:w-2/5 lg:w-1/3 p-3 sm:p-4 overflow-y-auto custom-scrollbar bg-white/80 backdrop-blur-sm md:bg-white/95 md:backdrop-blur-none shrink-0">
          <div id="listingsContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
            <!-- Shop cards are rendered here by JS -->
          </div>
          <div id="noResults" class="hidden text-center text-gray-600 mt-10 p-4">
            <!-- "No results" message by JS -->
          </div>
        </section>

        <!-- Shop Details Overlay (Right) -->
        <div id="detailsOverlayShop" class="detail-pop-overlay custom-scrollbar hidden">
            <button id="closeDetailsOverlayShopButton" class="overlay-close-button" aria-label="Close shop details">
                <svg class="w-6 h-6 sm:w-7 sm:h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <!-- Header of Shop Details (Fixed) -->
            <div class="p-4 pt-12 sm:pt-4 border-b border-gray-200 shrink-0">
                <h2 id="shopDetailName" class="text-xl sm:text-2xl font-bold text-gray-800 truncate">Shop Name Placeholder</h2>
                <!-- Potentially add short address/distance here if desired -->
            </div>
            <!-- Scrollable Content of Shop Details -->
            <div id="shopDetailsContent" class="flex-grow overflow-y-auto custom-scrollbar p-4 space-y-4">
                <div id="shopImageGallery" class="mb-2"> <!-- Reduced bottom margin slightly -->
                    <!-- CSV Images loaded here -->
                </div>
                <div class="opening-hours-section border-t pt-3">                    
                    <div id="shopOpeningHoursContainer"> <!-- Hours loaded here --> </div>
                </div>

                <div class="product-icons-section">
                    <h3 class="text-base sm:text-lg font-semibold text-gray-700 mb-2">Products Available</h3>
                    <div id="shopProductIconsContainer"> <!-- Icons loaded here --> </div>
                </div>
                 <div id="directionsControlSection" class="mt-3 pt-3 border-t">
                    <button id="getShopDirectionsButton" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-colors">Get Directions</button>
                    <button id="clearShopDirectionsButton" class="w-full hidden bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mt-2 transition-colors">Clear Directions</button>
                    <div id="directionsPanel" class="mt-3 text-sm bg-gray-50 p-2 border rounded"> <!-- Directions steps appear here --> </div>
                </div>
            </div>
            
        </div>
      </main>
    </div>


<!-- Initial Search Modal -->
    <div id="initialSearchModal" class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-[100] transition-opacity duration-300 ease-in-out">
        <div class="bg-white p-6 sm:p-8 rounded-lg shadow-xl w-11/12 max-w-md transform transition-all duration-300 ease-in-out scale-95 opacity-0">
            <h2 class="text-xl sm:text-2xl font-semibold text-gray-800 mb-4 text-center">Find Farm Stands Near You</h2>
            <gmp-place-autocomplete
                id="modalSearchAutocompleteElement"
                placeholder="Enter your town, city, or zip code"
                class="w-full p-3 border border-gray-300 rounded-md mb-4 shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm"
                place-fields="name,formatted_address,geometry,address_components,place_id,types"
                country="us">
            </gmp-place-autocomplete>
            <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3">
                <button id="modalSkipButton" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md transition-colors">Skip & See All</button>
                <button id="modalSearchButton" class="px-4 py-2 text-sm font-medium bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">Search</button>
            </div>
        </div>
    </div>



        <!-- END Initial Search Modal -->
<!-- AT THE END OF <body> -->
<script src="/js/utils.js" defer></script>
<script src="/js/apiService.js" defer></script>
 
<!-- Rendering helpers / UI Components -->
<script src="/js/sharedHtml.js" defer></script>
<script src="/js/shopDetailsRenderer.js" defer></script>
<script src="/js/socialRenderer.js" defer></script>
<script src="/js/listingsRenderer.js" defer></script>
<script src="/js/productFilter.js" defer></script> <!-- Defines populate/setup functions for filters -->

<!-- Core Logic Modules -->
<script src="/js/modalLogic.js" defer></script>    <!-- Defines initializeModalLogic -->
<script src="/js/overlayManager.js" defer></script>
<script src="/js/directionsUI.js" defer></script>
<script src="/js/router.js" defer></script> <!-- If you have router.js, put it here or before main.js -->

<!-- Initialization Scripts -->
<script src="/js/main.js" defer></script>       <!-- Populates AppState.dom, calls initializeModalLogic, handleRouteChange -->
                                                <!-- MUST come after modalLogic.js and router.js -->
<script src="/js/uiInit.js" defer></script>     <!-- Sets up UI event listeners AFTER AppState.dom is populated by main.js and after main.js might call things -->
                                                <!-- Or main.js should call an init function from uiInit.js after it populates AppState.dom -->

<!-- Facebook SDK -->
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v20.0&appId=YOUR_FACEBOOK_APP_ID&autoLogAppEvents=1" nonce="YOUR_NONCE_HERE"></script></body>
</html>
