import{H as _,j as l,J as I,b as L,c as k,K as E,L as C,N as F,Q as U,T as V}from"./index-cycpxOLf.js";import{b as a}from"./react-vendor-CH-h0uFD.js";function T(r,c=_){const[d,n]=a.useState(r);return a.useEffect(()=>{const i=setTimeout(()=>{n(r)},c);return()=>{clearTimeout(i)}},[r,c]),d}function B(r){const c=a.useRef(null),d=a.useRef(null),n=a.useRef(null),i=a.useRef(null),[f,g]=a.useState(!1),m=a.useCallback(async t=>{const u=t.placePrediction;if(u)try{const e=u.toPlace();await e.fetchFields({fields:["displayName","formattedAddress","location","viewport","addressComponents","types","id"]});const p={name:e.displayName||"",formatted_address:e.formattedAddress||"",geometry:e.location?{location:{lat:typeof e.location.lat=="function"?e.location.lat():e.location.lat,lng:typeof e.location.lng=="function"?e.location.lng():e.location.lng},viewport:e.viewport}:void 0,place_id:e.id,address_components:e.addressComponents,types:e.types},M=e.formattedAddress||e.displayName||"";r.onPlaceSelect(p,M)}catch(e){console.error("[PlaceAutocomplete] Error fetching place details:",e)}},[r]),h=a.useCallback(()=>{const t=d.current;if(!t)return;const s=t.getPlace();if(s.geometry&&s.geometry.location){const u={name:s.name,formatted_address:s.formatted_address,geometry:{location:{lat:s.geometry.location.lat(),lng:s.geometry.location.lng()},viewport:s.geometry.viewport},place_id:s.place_id,address_components:s.address_components,types:s.types},e=s.formatted_address||s.name||"";r.onPlaceSelect(u,e)}},[r]);a.useEffect(()=>{var M,w,D,R;if(r.disabled||!c.current||!((w=(M=window.google)==null?void 0:M.maps)!=null&&w.places))return;if(i.current&&(i.current(),i.current=null),typeof google.maps.places.PlaceAutocompleteElement=="function")try{const o=new google.maps.places.PlaceAutocompleteElement({types:r.types||["geocode"],includedRegionCodes:r.includedRegionCodes||["us"],locationBias:r.locationBias});o.addEventListener("gmp-select",m),c.current.appendChild(o),d.current=o,g(!1);const N=new MutationObserver(()=>{var A;const j=o.querySelector("input")||((A=o.shadowRoot)==null?void 0:A.querySelector("input"));j&&(n.current=j,N.disconnect())});N.observe(o,{childList:!0,subtree:!0});const v=o.querySelector("input")||((D=o.shadowRoot)==null?void 0:D.querySelector("input"));return v&&(n.current=v,N.disconnect()),i.current=()=>{var j;N.disconnect(),o.removeEventListener("gmp-select",m),(j=c.current)!=null&&j.contains(o)&&c.current.removeChild(o),d.current=null,n.current=null},()=>{i.current&&(i.current(),i.current=null)}}catch(o){console.warn("[PlaceAutocomplete] Failed to create PlaceAutocompleteElement, falling back to legacy:",o)}g(!0);const s=document.createElement("input");s.type="text",s.className="place-autocomplete-legacy-input",s.placeholder=c.current.dataset.placeholder||"Search for a location",s.setAttribute("aria-label",c.current.getAttribute("aria-label")||"Location search"),c.current.appendChild(s),n.current=s;const u={types:r.types||["geocode"],componentRestrictions:{country:((R=r.includedRegionCodes)==null?void 0:R[0])||"us"},fields:["place_id","name","formatted_address","geometry","address_components","types"]};if(r.locationBias){const o=r.locationBias;"north"in o&&"south"in o&&"east"in o&&"west"in o&&(u.bounds=new google.maps.LatLngBounds({lat:o.south,lng:o.west},{lat:o.north,lng:o.east}),u.strictBounds=!1)}const e=new google.maps.places.Autocomplete(s,u);d.current=e;const p=e.addListener("place_changed",h);return i.current=()=>{var N;google.maps.event.removeListener(p),google.maps.event.clearInstanceListeners(e),(N=c.current)!=null&&N.contains(s)&&c.current.removeChild(s);const o=document.getElementsByClassName("pac-container");for(let v=o.length-1;v>=0;v--)o[v].remove();d.current=null,n.current=null},()=>{i.current&&(i.current(),i.current=null)}},[m,h,r.types,r.includedRegionCodes,r.locationBias,r.disabled]);const b=a.useCallback(t=>{n.current&&(n.current.value=t)},[]),y=a.useCallback(()=>{var t;(t=n.current)==null||t.focus()},[]),x=a.useCallback(()=>{var t;(t=n.current)==null||t.blur()},[]),S=a.useCallback(()=>{var t;return((t=n.current)==null?void 0:t.value)||""},[]);return{containerRef:c,autocompleteRef:d,inputRef:n,setInputValue:b,focusInput:y,blurInput:x,getInputValue:S,isUsingLegacy:f}}const P=a.forwardRef(({onPlaceSelect:r,placeholder:c="Search for a location",initialValue:d="",className:n="",id:i,ariaLabel:f="Location search",includedRegionCodes:g=["us"],types:m=["geocode"],locationBias:h,disabled:b=!1,mapsApiReady:y=!0},x)=>{const{containerRef:S,setInputValue:t,focusInput:s,blurInput:u,getInputValue:e}=B({onPlaceSelect:r,includedRegionCodes:g,types:m,locationBias:h,disabled:b||!y});return a.useImperativeHandle(x,()=>({setInputValue:t,focus:s,blur:u,getValue:e}),[t,s,u,e]),a.useEffect(()=>{if(d){const p=setTimeout(()=>{t(d)},100);return()=>clearTimeout(p)}},[d,t]),y?l.jsxDEV("div",{ref:S,className:`place-autocomplete-container ${n}`,id:i,role:"search","aria-label":f,"data-placeholder":c},void 0,!1,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/UI/PlaceAutocomplete.tsx",lineNumber:122,columnNumber:5},void 0):l.jsxDEV("div",{className:`place-autocomplete-container place-autocomplete-loading ${n}`,id:i,role:"search","aria-label":f,children:l.jsxDEV("input",{type:"text",placeholder:"Loading maps...",disabled:!0,className:"place-autocomplete-fallback-input"},void 0,!1,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/UI/PlaceAutocomplete.tsx",lineNumber:111,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/UI/PlaceAutocomplete.tsx",lineNumber:105,columnNumber:7},void 0)});P.displayName="PlaceAutocomplete";const q=()=>{const[r,c]=a.useState(I),d=T(r,V),{setLastPlaceSelectedByAutocompleteAndCookie:n,searchTerm:i,setSearchTerm:f,mapsApiReady:g,currentRadius:m,setCurrentRadius:h,lastPlaceSelectedByAutocomplete:b,setMapViewTargetLocation:y}=L(),{closeShopOverlays:x,isFilterDrawerOpen:S}=k();a.useEffect(()=>{c(m)},[m]),a.useEffect(()=>{h&&d!==m&&h(d)},[d,m,h]);const t=a.useMemo(()=>{if(E)return{north:E.north,south:E.south,east:E.east,west:E.west}},[]),s=(b==null?void 0:b.formatted_address)||i||"",u=a.useCallback((e,p)=>{e.geometry?(n(e,p),f(p),y(e),x()):(f(p),n(null,p))},[n,f,y,x]);return l.jsxDEV(l.Fragment,{children:[l.jsxDEV("div",{id:"map-search-controls-mobile",className:"md:hidden fixed top-2 left-24 right-3 z-30",children:l.jsxDEV(P,{onPlaceSelect:u,placeholder:"Search location...",initialValue:s,className:"place-autocomplete-mobile",id:"mapSearchAutocompleteMobile",ariaLabel:"Search for locations by zip code, city, or address",types:["geocode","establishment"],includedRegionCodes:["us"],locationBias:t,mapsApiReady:g},void 0,!1,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/Map/MapSearchControls.tsx",lineNumber:90,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/Map/MapSearchControls.tsx",lineNumber:89,columnNumber:7},void 0),S&&l.jsxDEV("div",{id:"radius-slider-mobile",className:"md:hidden fixed top-12 left-3 right-3 z-30",children:l.jsxDEV("div",{className:"flex items-center gap-2 bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm rounded-lg shadow-lg px-3 py-2 border border-gray-200/50 dark:border-gray-700/50",children:[l.jsxDEV("label",{htmlFor:"radiusSliderMobile",className:"text-xs font-medium whitespace-nowrap text-gray-700 dark:text-gray-300",children:"Radius:"},void 0,!1,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/Map/MapSearchControls.tsx",lineNumber:108,columnNumber:13},void 0),l.jsxDEV("input",{type:"range",id:"radiusSliderMobile",name:"radius",min:F,max:C,value:r,step:U,onChange:e=>c(Number(e.target.value)),className:"flex-1 h-2 bg-gray-200 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-600","aria-label":"Search radius","aria-valuemin":F,"aria-valuemax":C,"aria-valuenow":r,"aria-valuetext":`${r} miles`},void 0,!1,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/Map/MapSearchControls.tsx",lineNumber:114,columnNumber:13},void 0),l.jsxDEV("span",{className:"text-xs font-semibold w-10 text-center text-gray-700 dark:text-gray-300","aria-live":"polite",children:[r," mi"]},void 0,!0,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/Map/MapSearchControls.tsx",lineNumber:130,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/Map/MapSearchControls.tsx",lineNumber:107,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/Map/MapSearchControls.tsx",lineNumber:106,columnNumber:9},void 0),l.jsxDEV("div",{id:"map-search-controls-desktop",className:"hidden md:flex fixed bottom-6 right-[44%] z-30 items-center gap-3",children:[l.jsxDEV("div",{id:"radius-slider-desktop",className:"flex items-center gap-2 bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm rounded-lg shadow-lg px-3 py-2 border border-gray-200/50 dark:border-gray-700/50",children:[l.jsxDEV("label",{htmlFor:"radiusSliderDesktop",className:"text-xs font-medium whitespace-nowrap text-gray-700 dark:text-gray-300",children:"Radius:"},void 0,!1,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/Map/MapSearchControls.tsx",lineNumber:145,columnNumber:11},void 0),l.jsxDEV("input",{type:"range",id:"radiusSliderDesktop",name:"radius",min:F,max:C,value:r,step:U,onChange:e=>c(Number(e.target.value)),className:"w-20 h-2 bg-gray-200 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-600","aria-label":"Search radius","aria-valuemin":F,"aria-valuemax":C,"aria-valuenow":r,"aria-valuetext":`${r} miles`},void 0,!1,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/Map/MapSearchControls.tsx",lineNumber:151,columnNumber:11},void 0),l.jsxDEV("span",{className:"text-xs font-semibold w-10 text-center text-gray-700 dark:text-gray-300","aria-live":"polite",children:[r," mi"]},void 0,!0,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/Map/MapSearchControls.tsx",lineNumber:167,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/Map/MapSearchControls.tsx",lineNumber:144,columnNumber:9},void 0),l.jsxDEV("div",{id:"search-input-desktop",children:l.jsxDEV(P,{onPlaceSelect:u,placeholder:"Enter a zip, city, or address",initialValue:s,className:"place-autocomplete-desktop",id:"mapSearchAutocompleteDesktop",ariaLabel:"Search for locations by zip code, city, or address",types:["geocode","establishment"],includedRegionCodes:["us"],locationBias:t,mapsApiReady:g},void 0,!1,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/Map/MapSearchControls.tsx",lineNumber:177,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/Map/MapSearchControls.tsx",lineNumber:176,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/Map/MapSearchControls.tsx",lineNumber:142,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/chris.majorossy/Projects/FarrmFinder/phreshfoods.com/src/components/Map/MapSearchControls.tsx",lineNumber:87,columnNumber:5},void 0)};export{q as default};
